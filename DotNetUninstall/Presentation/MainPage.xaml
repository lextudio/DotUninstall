<Page x:Class="DotNetUninstall.Presentation.MainPage" x:Name="RootPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:sys="using:System"
      xmlns:conv="using:DotNetUninstall.Presentation.Converters"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
  <Page.Resources>
    <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
    <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
  <conv:BoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" Invert="True" />
    <conv:StringEqualsToVisibilityConverter x:Key="StringEqualsToVisibilityConverter" />
  <conv:LifecycleStateToBrushConverter x:Key="LifecycleStateToBrushConverter" />
    <DataTemplate x:Key="InstallEntryTemplate">
      <Grid ColumnDefinitions="*,Auto" Padding="4" MinHeight="48" ToolTipService.ToolTip="{Binding Reason}">
        <StackPanel Orientation="Vertical" Margin="4" Spacing="4">
          <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
            <TextBlock Text="{Binding Version}" FontWeight="SemiBold"/>
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
            <!-- Release type (LTS/STS) -->
            <Border Background="#0E5A8A" CornerRadius="4" Padding="4,2" Visibility="{Binding ReleaseType, Converter={StaticResource NullToVisibilityConverter}}">
              <TextBlock FontSize="11" Foreground="White" Text="{Binding ReleaseType}"/>
            </Border>
            <!-- Preview kind badges -->
            <Border Background="#75507B" CornerRadius="4" Padding="4,2" Visibility="{Binding PreviewKind, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=preview}">
              <TextBlock Text="Preview" FontSize="11" Foreground="White"/>
            </Border>
            <Border Background="#5C3566" CornerRadius="4" Padding="4,2" Visibility="{Binding PreviewKind, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=rc}">
              <TextBlock Text="RC" FontSize="11" Foreground="White"/>
            </Border>
            <!-- Security update -->
            <Border Background="#8A2D3C" CornerRadius="4" Padding="4,2" Visibility="{Binding IsSecurityUpdate, Converter={StaticResource BoolToVisibilityConverter}}">
              <TextBlock Text="Security" FontSize="11" Foreground="White"/>
            </Border>
            <!-- Out of support -->
            <Border Background="#C0392B" CornerRadius="4" Padding="4,2" Visibility="{Binding IsOutOfSupport, Converter={StaticResource BoolToVisibilityConverter}}">
              <TextBlock Text="EOL" FontSize="11" Foreground="White"/>
            </Border>
            <Border Background="#334D5C" CornerRadius="4" Padding="4,2" VerticalAlignment="Center">
              <TextBlock Text="{Binding Architecture}" FontSize="11" Foreground="White"/>
            </Border>
            <Border Background="#556270" CornerRadius="4" Padding="4,2" VerticalAlignment="Center" Visibility="{Binding Reason, Converter={StaticResource NullToVisibilityConverter}}">
              <TextBlock Text="{Binding Reason}" FontSize="11" Foreground="White" TextTrimming="CharacterEllipsis" MaxWidth="260"/>
            </Border>
            <Border Background="#1F6F50" CornerRadius="4" Padding="4,2" VerticalAlignment="Center" Visibility="{Binding CanUninstall, Converter={StaticResource BoolToVisibilityConverter}}">
              <TextBlock Text="Removable" FontSize="11" Foreground="White"/>
            </Border>
          </StackPanel>
        </StackPanel>
        <Button Content="Uninstall" Grid.Column="1" Margin="4"
                Command="{Binding ElementName=RootPage, Path=DataContext.UninstallCommand}"
                CommandParameter="{Binding}" IsEnabled="{Binding CanUninstall}"/>
      </Grid>
    </DataTemplate>
  </Page.Resources>
  <Grid RowDefinitions="Auto,*,Auto">
    <Pivot Grid.Row="1" x:Name="MainPivot">
      <PivotItem Header="Runtimes">
        <ScrollViewer>
          <StackPanel>
            <TextBlock FontSize="12" Opacity="0.7" Margin="12,0,12,8"><Run Text="Count: "/><Run Text="{Binding RuntimeCount}"/></TextBlock>
            <ItemsControl ItemsSource="{Binding GroupedRuntimeItems}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <StackPanel Margin="8,0,8,12" Padding="0" CornerRadius="6">
                    <ToggleButton x:Name="GroupToggle" IsChecked="True" HorizontalAlignment="Stretch" Background="Transparent" BorderThickness="0" Padding="0">
                      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text=".NET" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Text="{Binding Channel}" FontWeight="Bold" FontSize="14"/>
                      </StackPanel>
                    </ToggleButton>
                    <Grid Margin="4,4,4,0" Visibility="{Binding IsChecked, ElementName=GroupToggle, Converter={StaticResource BoolToVisibilityConverter}}">
                      <ListView ItemsSource="{Binding Items}" ItemTemplate="{StaticResource InstallEntryTemplate}" SelectionMode="None"/>
                    </Grid>
                  </StackPanel>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </ScrollViewer>
      </PivotItem>
      <PivotItem Header="SDKs">
        <ScrollViewer>
          <StackPanel>
            <TextBlock FontSize="12" Opacity="0.7" Margin="12,0,12,8"><Run Text="Count: "/><Run Text="{Binding SdkCount}"/></TextBlock>
            <ItemsControl ItemsSource="{Binding GroupedSdkItems}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <StackPanel Margin="8,0,8,12" Padding="0" CornerRadius="6">
                    <ToggleButton x:Name="GroupToggle" IsChecked="True" HorizontalAlignment="Stretch" Background="Transparent" BorderThickness="0" Padding="0">
                      <Border Background="{Binding LifecycleState, Converter={StaticResource LifecycleStateToBrushConverter}}" CornerRadius="4" Padding="6,4" Margin="0,0,0,4">
                        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="2">
                          <TextBlock Text=".NET" FontWeight="Bold" FontSize="14"/>
                          <TextBlock Text="{Binding Channel}" FontWeight="Bold" FontSize="14"/>
                        </StackPanel>
                        <Border Background="#0E5A8A" CornerRadius="4" Padding="4,2" Visibility="{Binding ReleaseType, Converter={StaticResource NullToVisibilityConverter}}">
                          <TextBlock Text="{Binding ReleaseType}" FontSize="11" Foreground="White"/>
                        </Border>
                        <Border Background="#C0392B" CornerRadius="4" Padding="4,2" Visibility="{Binding SupportPhase, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=eol}">
                          <TextBlock Text="EOL" FontSize="11" Foreground="White"/>
                        </Border>
                        <Border Background="#7F8C8D" CornerRadius="4" Padding="4,2" Visibility="{Binding EolDisplay, Converter={StaticResource NullToVisibilityConverter}}">
                          <TextBlock Text="{Binding EolDisplay}" FontSize="11" Foreground="White"/>
                        </Border>
                        <Border Background="#8A6D1A" CornerRadius="4" Padding="4,2" Visibility="{Binding SupportPhase, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=maintenance}">
                          <TextBlock Text="Maintenance" FontSize="11" Foreground="White"/>
                        </Border>
                        <Border Background="#1F6F50" CornerRadius="4" Padding="4,2" Visibility="{Binding SupportPhase, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=active}">
                          <TextBlock Text="Active" FontSize="11" Foreground="White"/>
                        </Border>
                        <Border Background="#75507B" CornerRadius="4" Padding="4,2" Visibility="{Binding SupportPhase, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=preview}">
                          <TextBlock Text="Preview" FontSize="11" Foreground="White"/>
                        </Border>
                        </StackPanel>
                      </Border>
                    </ToggleButton>
                    <Grid Margin="4,4,4,0" Visibility="{Binding IsChecked, ElementName=GroupToggle, Converter={StaticResource BoolToVisibilityConverter}}">
                      <ListView ItemsSource="{Binding Items}" ItemTemplate="{StaticResource InstallEntryTemplate}" SelectionMode="None"/>
                    </Grid>
                  </StackPanel>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </StackPanel>
        </ScrollViewer>
      </PivotItem>
      <PivotItem Header="Settings">
        <StackPanel Spacing="8" Padding="12">
          <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
            <Button Content="Refresh" Command="{Binding RefreshCommand}"/>
            <ProgressRing Width="24" Height="24" IsActive="{Binding IsLoading}"/>
            <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center" Margin="8,0,0,0"/>
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
            <TextBlock Text="Tool:" VerticalAlignment="Center"/>
            <TextBox Width="320" Text="{Binding UninstallToolPath, Mode=TwoWay}"/>
            <Button Content="Browse" Command="{Binding BrowseCommand}"/>
            <TextBlock Margin="12,0,0,0" VerticalAlignment="Center" FontSize="11" Opacity="0.6" Visibility="{Binding UninstallToolVersion, Converter={StaticResource NullToVisibilityConverter}}">
              <Run Text="ver "/><Run Text="{Binding UninstallToolVersion}"/>
            </TextBlock>
          </StackPanel>
          <StackPanel Background="#22000000" Padding="8" Spacing="6" CornerRadius="6" Visibility="{Binding HasUninstallTool, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <TextBlock Text="dotnet-core-uninstall tool not detected." FontWeight="Bold"/>
            <TextBlock TextWrapping="WrapWholeWords">
              <Run Text="Download from "/>
              <Hyperlink NavigateUri="https://github.com/dotnet/cli-lab/releases">
                <Run Text="GitHub Releases"/>
              </Hyperlink>
              <Run Text=" and select the package matching your OS/architecture below:"/>
            </TextBlock>
            <TextBlock FontSize="12" Text="Suggested download:"/>
            <TextBlock FontSize="12" FontWeight="SemiBold" Text="{Binding SuggestedDownload}"/>
            <TextBlock FontSize="11" Opacity="0.7" Text="After download, set DOTNET_UNINSTALL_TOOL env var or browse to the executable."/>
          </StackPanel>
          <TextBlock Foreground="Red" TextWrapping="WrapWholeWords" Text="{Binding ErrorMessage}"/>
        </StackPanel>
      </PivotItem>
    </Pivot>
    <TextBlock Grid.Row="2" FontSize="10" Opacity="0.6" Margin="12,0,12,8" Text="If an uninstall fails due to permissions, run manually in terminal with elevated rights."/>
  </Grid>
</Page>
